<!DOCTYPE html>
<html>
<head>
  <title>Bell Inequality Experiment</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.8.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.8.0/vis.min.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    table {
      border-collapse: collapse;
    }
    table td, table th {
      border: 1px solid black;
      padding: 5px;
    }
  </style>
</head>
<body>
  <div id="results-data" style="display: none;">{&quot;QM Prediction&quot;:[62462,62162,61563,60673,59500,58054,56350,54405,52236,49866,47316,44611,41778,38843,35835,32783,29717,26665,23657,20722,17889,15184,12634,10264,8095,6150,4446,3000,1827,937,338,38],&quot;VIII Example HVT&quot;:[61514,59154,57288,55514,53730,51913,50289,47774,46105,44493,41991,39752,38039,36100,33909,31984,30111,28437,26493,24092,22683,20304,18285,16594,14597,12732,10909,8749,6679,4896,2986,983],&quot;Custom Naive HVT 0&quot;:[62330,62282,62062,61405,60782,58691,57454,56000,54056,50641,47875,44610,41738,38579,34994,31757,28670,25220,22058,19354,16569,14028,11559,9382,7265,5513,4038,2603,1613,799,328,30]}</div>
  <div id="results-graph"></div>
  <table id="result-table">
    <thead>
      <tr>
        <th>Degrees</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    var N_SIML = 4000000;
    var N_ARES = 32;
    var results = JSON.parse($("#results-data").text());
    var n_groups = 0;
    var items = new vis.DataSet();
    var groups = new vis.DataSet();
    var tdata = [];
    var tdata_idx = {};
    for (var group_name in results) {
      groups.add({
        id: n_groups,
        content: group_name
      });
      var hvt_res = results[group_name];
      for (var i_angle = 0; i_angle < N_ARES; i_angle++) {
        var x = (((Math.PI / 2) / N_ARES) / 2) * (i_angle * 2 + 1) * 180 / Math.PI;
        var y = hvt_res[i_angle] / (N_SIML / N_ARES);
        items.add({
          x: 10 * x,
          y: y,
          group: n_groups
        });
        var tidx = Math.round(x * 10) / 10;
        if (!tdata_idx[tidx]) {
          var rdata = tdata_idx[tidx] = [];
          rdata.push(tidx);
          tdata.push(rdata);
        }
        tdata_idx[tidx].push(parseFloat(Math.round(y * 1e5) / 1e5).toFixed(4));
      }
      $("#result-table thead tr").append(
        $("<th>").text(group_name)
      );
      n_groups++;
    }
    for (var row in tdata) {
      var tr = $("<tr>");
      var rdata = tdata[row];
      for (var i = 0; i < rdata.length; i++) {
        var col = rdata[i];
        if (i > 1) {
          col += " (" + (Math.round(((col - rdata[1]) / rdata[1]) * 1e5) / 1e3) + "%)";
        }
        tr.append($("<td>").text(col));
      }
      $("#result-table tbody").append(tr);
    }
    var options = {
      dataAxis: {
        left: {
          format: function(v) {
            return Math.round(v * 1000) / 1000;
          },
          range: {min: 0}
        }
      },
      legend: true,
      // Hack: The X axis is actually a timeline with miliseconds presented as degrees.
      start: 0.0,
      min: 0,
      end: 900,
      max: 900,
      showMajorLabels: false,
      showMinorLabels: true,
      format: {minorLabels: {millisecond: "SS"}},
      timeAxis: {scale: "millisecond", step: 100}
    };
    var container = $("#results-graph").get(0);
    var graph2d = new vis.Graph2d(container, null, options);
    graph2d.setGroups(groups);
    graph2d.setItems(items);
    window.graph2d = graph2d;
  </script>
</body>
</html>
